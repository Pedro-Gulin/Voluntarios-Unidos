{% extends"base.html" %}
{% block content%}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Novos Voluntários por Mês</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#f8f9fa; font-family:Arial,sans-serif; padding:2rem; }
    .container { max-width:900px; margin:auto; background:#fff; padding:2rem; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.05); }
  </style>
</head>
<body>
  <div class="container">
    <h3 class="mb-3">Relatório: Novos Voluntários por Mês</h3>

    <div class="input-group mb-4" style="max-width:300px;">
      <input type="number" id="ano" class="form-control" min="2000" max="2100">
      <button class="btn btn-primary" id="buscar">Buscar</button>
    </div>

    <canvas id="grafico"></canvas>
  </div>

  <script>
    const ctx = document.getElementById('grafico').getContext('2d');
    const anoInput = document.getElementById('ano');
    let grafico;

    async function carregarGrafico(ano) {
      const resp = await fetch(`/api/novos_volu_ano?ano=${ano}`);
      const data = await resp.json();

      if (!resp.ok) return alert(data.error || 'Erro ao carregar dados');

      const meses = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
      const labels = data.labels.map(m => meses[m-1] || m);

      if (grafico) grafico.destroy();

      grafico = new Chart(ctx, {
        type: 'bar',
        data: { ...data, labels },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: data.labels.length 
                ? `Novos voluntários em ${ano}` 
                : `Sem dados disponíveis para ${ano}`
            },
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Quantidade' } },
            x: { title: { display: true, text: 'Mês' } }
          }
        }
      });
    }

    document.getElementById('buscar').onclick = () => carregarGrafico(anoInput.value);

    const atual = new Date().getFullYear();
    anoInput.value = atual;
    carregarGrafico(atual);
  </script>
</body>
</html>
{% endblock%}